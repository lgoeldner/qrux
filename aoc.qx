; 2019 day 1

(val! inp (slurp "input.txt"))

(defun! get-fuel (it)
  (- (/ it 3) 2))

(defun! total-fuel (mass (total 0))
  (let ((fuel (get-fuel mass)))
    (if (fuel \<= 0)
      total
      (total-fuel fuel (+ total fuel)))))

(export! '(total-fuel))

(-> inp
    (str:splitby "\n")
    (map :f total-fuel)
    (reduce :f +))